<!-- Photorank checkout code -->
<script type="text/javascript" data="olapic-checkout">
  var olapicProducts = '';

  var line_items= <%= raw order.line_items.to_json %>

    line_items.forEach(function(line_item_object){
      line_item = line_item_object.line_item
      // Product loop starts. This is where you will store each product purchased info
      olapicProducts += ((olapicProducts === '') ? '' : ',' ) +  '{"id":"'+encodeURIComponent(line_item.variant_id)+'","price":"'+encodeURIComponent(line_item.price)+'"}';
      // Product loop ends.
    });

  window.onload = function() {
    ;(function(w, d){
      olapicProducts = '['+olapicProducts+']';
      var olapicCheckout = d.createElement("script"); olapicCheckout.async = true;
      olapicCheckout.setAttribute("olapicProducts", olapicProducts);
      olapicCheckout.setAttribute("olapicApiKey", encodeURIComponent("11aa7ed151891f52782c3c345fa0d25159331c893eee49dd2b3a93d076bad452"));
      olapicCheckout.setAttribute("olapicIdentifier", encodeURIComponent("<%= @order.email %>"));
      olapicCheckout.setAttribute("olapicAmount", encodeURIComponent("<%= @order.amount.to_f %>"));
      olapicCheckout.setAttribute("olapicTransactionId", encodeURIComponent("<%= @order.id %>"));
      olapicCheckout.setAttribute("olapicEmail", encodeURIComponent("<%= @order.email %>"));
      olapicCheckout.setAttribute("olapicName", encodeURIComponent("<%= @order.try(:bill_address).try(:full_name) %>"));
      olapicCheckout.setAttribute("olapicCurrencyCode", encodeURIComponent("<%= @order.currency %>"));
      olapicCheckout.src="//www.photorank.me/static/js/olapic.checkout.js";
      d.body.appendChild(olapicCheckout);
    })(window, document);
  }
</script>
