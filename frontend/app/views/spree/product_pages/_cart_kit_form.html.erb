<% unless Rails.env.production? %>
	<a href="<%= spree.edit_admin_product_variant_url(product.permalink,variant.id) %>">goto admin</a>
<% end %>

<% if variant.level %>
	<p class="level">Level <span><%= variant.level %></span></p>
<% end %>

<%= form_for :order, :url => populate_orders_path do |f| %>
<%= hidden_field_tag "products[target_id]", target_id %>

<div class="product-price prices" data-hook="product_price">
	<% if variant.has_price? %>
		<span class="<%=variant.normal_price_classes %> unselected" data-price="<%= variant.price.in_subunit %>" data-currency="<%= variant.currency_symbol %>"><%= variant.price_html %></span>
		<span class="<%= variant.sale_price_classes %>" data-price="<%= variant.sale_price.in_subunit %>" data-currency="<%= variant.currency_symbol %>"><%= variant.sale_price_html %></span>
	<% end %>
</div>

<div class="row row-assembly">
	<div class="assembly-menus large-10 small-8 column">
		<ol>
			<% product.assembly_definition.parts.decorate(context: @context).each do |part|%>
			<% required_class = part.optional ? 'optional' : 'required' %>
			
			<% if part.memoized_grouped_option_values.any?  %>
				<li class="product-variants <%= required_class %>" data-tree="<%= part.memoized_variant_options_tree.to_json %>" data-adjustment="0"><%= part.presentation %> <span class="color-value"></span>
					<% part.memoized_grouped_option_values.each do |type, values| %>
					<div class="variant-options <%= type.url_safe_name.downcase %> <%= required_class %>" data-type="<%= type.url_safe_name.downcase %>">
						<p><%= part.product.name %></p>
						<ul class="variant-option-values <%= type.url_safe_name.downcase %>">
							<% values.sort_by(&:position).each do |value| %>
							<% classes = ["option-value", value.url_safe_name, type.url_safe_name] %>
								<li>
			                		<%= link_to value.has_image? ? image_tag(value.image.url, :alt => value.presentation) : content_tag(:span, value.presentation), "#", :title => value.presentation, :class => classes.join(" "), data: {type: type.url_safe_name, value: value.url_safe_name, presentation: value.presentation } %>
									<p class="assembly-name"><%= value.presentation %></p>
								</li>
							<% end %>
						</ul>
					</div>
					<% end %>
					<input class="selected-parts" type="hidden" name="parts[<%= part.id %>][]" value="" />
				</li>
			<% end %>
			<% end %>
		</ol>
		
		<% if product.price and !product.price.nil? %>
		<div class="add-to-cart">
			<label>Quantity</label>
			<%= number_field_tag (product.memoized_targeted_grouped_option_values.any? ? :quantity : "variants[#{product.master.id}]"), 1, :id => 'qty', :min => 1 %>
			<%= button_tag :class => 'add-to-cart-button tooltip small disabled', :type => :submit, :style => "opacity: 0.5", :title => "Please select above options" do %>
				<%= Spree.t(:add_to_cart) %>
			<% end %>
		</div>
		<% end %>
	</div>
	<div class="assembly-images large-2 small-4 column">
		<ul class="no-bullet">
			<% product.assembly_definition.parts.decorate(context: @context).each do |part|%>
			<li></li>
			<% end # assembly_definition.memoized_grouped_option_values.each  %>
		</ul>
	</div>
</div><!-- /.row -->

<% end %>