core.suitesIndex = {};

var readySuitesIndex = function() {
  if (!$('body').hasClass('suites-index')) return false;

  // Kill existing event handlers before reassigning...
  //$('.row-product').find('*').off();

  if (core.isMobileWidthOrLess() === false) {
    core.productOverlays();
  }

  core.suitesIndex.setScrollPosition();
  core.suitesIndex.readyLazyLoadImages();
  core.suitesIndex.extendClickableArea();
  core.suitesIndex.readyPagination();
  core.suite.readyOutOfStock();
};

$(document).on('page:load ready', readySuitesIndex);

/* ----- Init methods ----- */


core.suitesIndex.readyLazyLoadImages = function() {
  $('img.lazy-load').each(function() {
    $(this).lazyload({
      load: function() {
              // $(this).removeClass('lazy-load');
            }
    });
  });
}

// Where an index product has just one link on hover, extend the clickable area to the whole image
core.suitesIndex.extendClickableArea = function() {
  if (core.isTabletWidthOrLess() === false) {
    var lists = $('.row-product ul');

    lists.each(function() {
      var links = $(this).find('a');

      if (links.length == 1) {
        $(this).css('cursor', 'pointer');
        $(this).on('click', function(e) {
          window.location.href = links.attr('href');
        });
      }
    });
  }
}

// Do we have a position to scroll to?
core.suitesIndex.setScrollPosition = function() {
  // If we've got a flash error, let's scroll to that
  var flash = $('.flash.error');
  if (flash.length > 0) {
    $(window).scrollTop(flash);
  } else {
    var cookie = $.cookie('suitesIndexScrollTop');
    if (cookie) {
      $(window).scrollTop(cookie);
    }
  }
}

core.suitesIndex.readyPagination = function() {
  var pagination_links = $('.pagination').find('a');

  pagination_links.on('click', function(e) {
    $.cookie('suitesIndexScrollTop', $(window).scrollTop());
  });
}

core.suite.readyOutOfStock = function() {
  if ($('.out-of-stock-form')) {
    core.suite.requestOutOfStock();
  }
}

core.suite.requestOutOfStock = function() {
  var section = $('.section-out-of-stock');
  var form = section.find('.out-of-stock-form');

  var heading_primary = section.find('h5');
  var heading_secondary = section.find('p');

  form.on('submit', function(e) {
    e.preventDefault();

    // Die if no value
    var email = form.find('input[name="signupEmail"]').val();

    if (!email) return false;
    form.fadeOut('slow');

    $.ajax({
      type: 'POST',
      url: form.attr('action'),
      data: form.serialize(),
      dataType: 'json',
      success: function(e) {

        if (e.response !== 'success') {
          form.fadeOut('slow');

          heading_primary.text("Oops, something\'s gone wrong, please try again");
          form.fadeIn('slow');
        } else {
          // select exact text
          var heading_primary_text = document.getElementById('notice');
          var success_message = document.getElementById('success-message');

          // change text + styling
          heading_primary.text("Thanks " + email);
          heading_primary_text.className = "green";
          success_message.style.display = 'initial';

          // fade sections back in
          heading_primary.fadeIn('slow');
          heading_secondary.fadeIn('slow');
        }
      }
    })
  })
}

/* ----- Non-init methods ----- */

// core.suitesIndex.showLoadingImage = function() {
// 	$('<%= cdn_image_tag("product-group/loading.gif", class: "loading-image", width: "60", height: "60",  alt: "") %>').insertAfter($('.row-product'));
// }

// core.suitesIndex.hideLoadingImage = function() {
// 	$('.loading-image').remove();
// }
