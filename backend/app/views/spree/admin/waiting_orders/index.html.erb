<% content_for :page_title do %>
  <%= Spree.t(:orders_to_be_dispatched) %>
<% end %>

<% content_for :page_actions do %>
  <li>
    <%= button_link_to Spree.t(:print_invoices), invoices_admin_waiting_orders_url(format: :pdf), :icon => 'icon-plus', :id => 'invoices-pdf', :target => "_blank" %>
    <%= button_link_to Spree.t(:print_stickers), image_stickers_admin_waiting_orders_url(format: :pdf), :icon => 'icon-plus', :id => 'image-stickers-pdf', :target => "_blank" %>
  </li>
<% end %>


<%= render :partial => 'spree/admin/shared/order_sub_menu' %>

<%= form_tag admin_waiting_orders_path, :method => :get do %>
<fieldset>
<%= label_tag "Batch ID" %>
<%= text_field_tag :batch_id, params[:batch_id] %>
<%= submit_tag "Filter" %>
</fieldset>
<% end %>

<% if @curr_page -%>
  <%= paginate @orders %>
<% end -%>

<% unless @orders.empty? %>
  <table class="index responsive" id="listing_orders" data-hook>
    <colgroup>
       <col style="width: 10%;">
       <col style="width: 10%;">
       <col style="width: 10%;">
       <col style="width: 10%;">
       <col style="width: 10%;">
       <col style="width: 15%;">
       <col style="width: 35%;">
    </colgroup>
    <thead>
      <tr data-hook="admin_orders_index_headers">
        <th><%= Spree.t(:batch_id) %></th>
        <th><%= I18n.t(:number, :scope => 'activerecord.attributes.spree/order') %></th>
        <th><%= I18n.t(:invoice, :scope => 'activerecord.attributes.spree/order') %></th>
        <th><%= I18n.t(:sticker, :scope => 'activerecord.attributes.spree/order') %></th>
        <th><%= I18n.t(:email, :scope => 'activerecord.attributes.spree/order') %></th>
        <th><%= I18n.t(:total, :scope => 'activerecord.attributes.spree/order') %></th>
        <th><%= Spree.t(:parcels) %></th>
        <th data-hook="admin_orders_index_header_actions" class="actions"></th>
      </tr>
    </thead>
    <tbody>
    <% @orders.each_with_index do |order| %>
      <tr data-hook="admin_orders_index_rows" class="state-<%= order.state.downcase %> <%= cycle('odd', 'even') %>">
        <td class="align-center"><%= order.batch_print_id %></td>
        <td class="align-center"><%= link_to order.number, edit_admin_order_path(order) %></td>
        <td class="align-center"><%= order.batch_invoice_print_date.present? ? "Printed" : "Not printed" %></td>
        <td class="align-center"><%= order.batch_sticker_print_date.present? ? "Printed" : "Not printed" %></td>
        <td><%= mail_to order.email %></td>
        <td class="align-center"><%= order.display_total.to_html %></td>
        <td class="align-center"><%= render :partial => 'boxes', :locals => {order: order, all_boxes: @all_boxes} %></td>
        <td class='actions align-center' data-hook="admin_orders_index_row_actions">
          <%= link_to_with_icon 'icon-edit', Spree.t(:add_box), admin_waiting_order_path(order), :title => "admin_#{dom_id(order)}", :no_text => true, :class => 'add-box-to-order', 'data-order' => "order-#{order.id}" %>
          <%= button_to 'consignment', create_and_allocate_consignment_admin_waiting_order_path(id: order.id, page: params[:page]) %>
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>
<% else %>
  <div class="no-objects-found">
    <%= Spree.t(:no_orders_found)%>
  </div>
<% end %>

<% if @curr_page -%>
  <%= paginate @orders %>
<% end -%>

<script>
$(document).ready(function(){
$('.add-box-to-order').on('click', function(){
$('#'+$(this).data('order')).show();
return false;
});
})
</script>
