<script type="text/javascript">
  function displayRow(){
    var row = document.getElementById("captionRow");
    if (row.style.display == '') row.style.display = 'none';
    else row.style.display = '';
  }
</script>
<h4><%= t('available_supply_products') %></h4>
<table class="index">
  <thead>
      <tr>
        <th><%= t("part") %></th>
        <th>Presentation</th>
        <th><%= t("qty") %></th>
        <th><%= t("optional") %></th>
        <th></th>
      </tr>
  </thead>
  <tbody>
    <% @available_parts.each do |part| %>
      <tr id="<%= dom_id(part) %>">
        <td data-part-id="<%= part.id %>"><%= part.name %><br><small>(<%= part.product_type.name %>)</small></td>
        <td class="presentation"><%= text_field_tag "part[presentation]", '' %></td>
        <td class="count"><%= text_field_tag "part[count]", 1 %></td>
        <td class="optional"><%= check_box_tag( "part[optional]", false ) %></td>
        <td class="actions">
          <%= image_tag "spinner.gif", :style => "display:none", :class => "spinner" %>
            <%= link_to(icon('add') + ' ' + t('select'),
                      admin_product_product_parts_path(@product),
                      :class => "add_part_link") %>
            </td>
      </tr>
    <% end %>
    <% if @available_parts.empty? %>
     <tr><td colspan="3"><%= t('no_match_found') %>.</td></tr>
    <% end %>
  </tbody>
  </table>

  <%= javascript_tag do %>
    $("a.add_part_link").click(function(){
      var pid = $(this).parents('tr').find('td[data-part-id]').data('part-id');
      params =  {
        product_part:
        {
          part_id :  pid,
          count :  $(this).parents('tr').find(".count :text").val(),
          optional : $('#part_optional:checked', $(this).parent().parent()).length > 0 ? 'true' : 'false',
          presentation: $(this).parents('tr').find(".presentation :text").val()
        }
      };
    return make_post_request($(this), params);
  });
<% end %>
