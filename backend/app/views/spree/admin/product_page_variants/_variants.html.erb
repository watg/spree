<% displayed ||= false -%>

<table class="index variants <%= displayed ? 'displayed' : '' %>" data-url="<%= update_positions_admin_product_page_variants_path(@product_page) %>">
    <colgroup>
      <col style="width: 5%" />
      <col style="width: 20%" />
      <col style="width: 15%" />
      <col style="width: 10%" />
      <col style="width: 20%" />
      <col style="width: 20%" />
      <col style="width: 5%" />
      <col style="width: 5%" />
    </colgroup>
    <thead data-hook="variants_header">
      <tr>
	<th/>
        <th><%= Spree.t(:image) %></th>
        <th><%= Spree.t(:product) %></th>
        <th><%= Spree.t(:type) %></th>
        <th><%= Spree.t(:sku) %></th>
        <th><%= Spree.t(:variant_combination) %></th>
        <th><%= Spree.t(:description) %></th>
        <th><%= Spree.t(:count) %></th>
        <th><%= Spree.t(:visible) %></th>
      </tr>
    </thead>
    <tbody>
      <% if displayed -%>
      <tr class="empty">
	<td colspan="9">
	  <p><em>No variants</em></p>
	</td>
      </tr>
      <% end -%>
      <% if variants.present? -%>
      <% variants.each do |variant| %>
        <tr class="variant" id="variant-<%= variant.id %>" data-variant-id="<%= variant.id %>" data-url="<%= admin_product_page_variants_path(@product_page) %>">
	  <td class="no-border">
	    <span class="handle" />
	  </td>
          <td>
            <% if (images = variant.images_for(@product_page.target)).any? %>
              <%= image_tag(images.first.attachment.url(:listing)) %>
            <% else %>
              No image
            <% end %>
          </td>
          <td><%= link_to variant.name, edit_admin_product_path(variant.product) %></td>
          <td><%= variant.product.martin_type.name %></td>
          <td><%= variant.sku %></td>
          <td><%= link_to ( variant.is_master? ? "Master variant" : variant.options_text), edit_admin_product_variant_path(variant.product,variant)  %></td>
          <td><p title="<%= variant.description %>"><%= truncate(variant.description) %></td>
          <td><%= variant.total_on_hand %></td>
          <td><%= check_box_tag 'variant_ids[]', variant.id, displayed, class: "display-toggle" %></td>
	<% end %>
	<% end %>
    </tbody>
  </table>
