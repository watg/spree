<%= render :partial => 'spree/admin/shared/product_sub_menu' %>
<%= render :partial => 'spree/admin/shared/product_tabs', :locals => {:current => 'Variant Images'} %>

<% content_for :page_actions do %>
  <% if previous_variant = @variant.previous %>
    <li><%= link_to_with_icon('fa fa-arrow-left', Spree.t(:previous), admin_variant_images_url(previous_variant) , :class => 'button') %></li>
  <% end %>
  <% if next_variant = @variant.next %>
    <li><%= link_to_with_icon('fa fa-arrow-right', Spree.t(:next),admin_variant_images_url(next_variant) , :class => 'button') %></li>
  <% end %>
<% end %>

<% content_for :sidebar, id: 'sidebar' do %>
  <h5 class="sidebar-title parts-sidebar">Variants List</h5>
  <hr>
  <nav class="menu">
    <ul>
      <% @variant.product.variants.each do |v| %>
        <li <%== 'class="active"' if v == @variant %>>
          <%= link_to v.options_text, admin_variant_part_images_url(v) %>
        </li>
      <% end %>
    </ul>
  </nav>
<% end %>

<div id="images" data-hook></div>

<fieldset>
  <legend align="center"><%= @variant.options_text %> Part Images</legend>

  <div id="uploads_container"></div>
  <script id="template-upload" type="text/x-tmpl">
    <div id="upload_{%=o.unique_id%}" class="upload">
      <h5>{%=o.name%}</h5>
      <div class="progress progress-striped active"><div class="bar" style="width: 0%"></div></div>
    </div>
  </script>

  <%= s3_uploader_form callback_url: s3_callback_admin_variant_part_images_path,
    id: "s3_uploader",
    callback_param: "image[direct_upload_url]",
    expiration: 24.hours.from_now.utc.iso8601,
    max_file_size: 100.megabytes do %>

    <div class="field">
      <%= label_tag Spree.t(:filename) %><br>
      <%= file_field_tag :file, multiple: true %>
    </div>

  <% end %>
</fieldset>

<table class="index sortable" data-hook="images_table" data-sortable-link="<%= update_positions_admin_variant_images_url(@variant) %>">
  <thead>
    <tr data-hook="images_header">
      <th colspan="2"><%= Spree.t(:swatch) %></th>
      <th class="actions"></th>
    </tr>
  </thead>
  <tbody id="images_table_body">
    <% unless @variant.part_image %>
      <div class="no-objects-found">
        <%= Spree.t(:no_part_image_found) %>.
      </div>
    <% else %>
      <%= render 'part_image', part_image: @variant.part_image %>
    <% end %>
  </tbody>
</table>

<br>
<div class="form-buttons filter-actions actions">
  <%= link_to_with_icon('fa fa-refresh', Spree.t(:update), '#', :class => 'button update_all_images') %>
  <span class="or"><%= Spree.t(:or) %></span>
  <%= button_link_to Spree.t('actions.cancel'), collection_url, :icon => 'fa fa-remove' %>
</div>