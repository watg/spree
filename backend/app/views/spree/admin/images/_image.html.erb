<tr id="<%= spree_dom_id image %>" data-hook="images_row" class="<%= cycle('odd', 'even')%>">
  <td class="no-border">
    <span class="handle"></span>
  </td>
  <td>
    <% if image.processed? %>
      <%= link_to image_tag(image.attachment.url(:small), style: "max-width: 180px"), image.attachment.url(:product) %>
    <% else %>
      <%= link_to image_tag(image.direct_upload_url, style: "max-width: 180px"), image.attachment.url(:product) %>
    <% end %>
  </td>
  
  <td>
    <%= form_for [:admin, @product, image], remote: true do |f| %>
      
      <% if image.viewable_type.kind_of? Spree::Personalisation %>
        <%= check_box_tag :activate_personalization, value: 1 %>
      <% else %>
        <%= check_box_tag :activate_personalization, value: 0 %>
      <% end %>


      <%= f.label :variant_id, Spree.t(:variant) %><br>
      <%= select_tag 'image[variant_id]', options_for_select(@variants, get_variant_id(image)), :class => 'select3' %>
      <br><br>

      <div id="image_personalisation">
        <%= f.label :personalisation, 'personalisation: ' %>
        <%= select_tag 'image[personalisation_id]', options_for_select( @product.personalisations.map {|p| [p.name, p.id]}, get_personalisation_id(image) ), { :include_blank => Spree.t('match_choices.none'), :class => 'select3 fullwidth'} %>
      </div>
      <br><br>
      
    <% end %>
  </td>           

  <td class="actions">
    <%= link_to '', '#', :class => 'save-item icon_link icon-ok no-text with-tip', :title => Spree.t('actions.save'), :onclick=>"$('#edit_image_#{image.id}').submit(); return false;" %>

    <%= link_to_with_icon 'icon-edit', Spree.t(:edit), edit_admin_product_image_url(@product, image), :no_text => true, :data => {:action => 'edit'} %>
    <%= link_to_delete image, { :url => admin_product_image_url(@product, image), :no_text => true } %>
  </td>
</tr>