<%= render :partial => "spree/admin/variants/split", :formats => :js %>
<fieldset class="no-border-bottom">
  <legend align="center" class="stock-location" data-hook="stock-location">
    <span class="shipment-number"><%= shipment.number %></span>
    -
    <span class="shipment-state"><%= Spree.t("shipment_states.#{shipment.state}") %></span>
    <%= Spree.t(:package_from) %>
    <strong class="stock-location-name" data-hook="stock-location-name">'<%= shipment.stock_location.name %>'</strong>
    <% if shipment.ready? && order.internal? && can?(:update, shipment) %>
      -
      <%= link_to Spree.t(:ship), '#', :class => 'ship button icon-arrow-right', :data => {'shipment-number' => shipment.number} %>
    <% end %>
  </legend>
</fieldset>

<table class="stock-contents index" data-hook="stock-contents">
  <colgroup>
    <col style="width: 5%;" />
    <col style="width: 10%;" />
    <col style="width: 40%;" />
    <col style="width: 10%;" />
    <col style="width: 15%;" />
    <col style="width: 10%;" />
    <col style="width: 10%;" />
  </colgroup>

  <thead>
    <th colspan="3"><%= Spree.t(:item_description) %></th>
    <th><%= Spree.t(:price) %></th>
    <th><%= Spree.t(:qty) %></th>
    <th><%= Spree.t(:total) %></th>
    <th class="orders-actions actions" data-hook="admin_order_form_line_items_header_actions"></th>
  </thead>

  <tbody data-shipment-number="<%= shipment.number %>" data-order-number="<%= order.number %>">
    <%= render('spree/admin/orders/shipment_manifest', order: order, shipment: shipment) if shipment %>

    <% unless shipment.shipped? %>
      <tr class="edit-method hidden total">
        <td colspan="6">
          <div class="field alpha five columns">
            <%= label_tag 'selected_shipping_rate_id', Spree.t(:shipping_method) %>
            <%= select_tag :selected_shipping_rate_id,
                  options_for_select(shipment.shipping_rates.with_shipping_method.map {|sr| ["#{sr.name} #{sr.display_price}", sr.id] }, shipment.selected_shipping_rate_id),
                  {:class => 'select2 fullwidth', :data => {'shipment-number' => shipment.number } } %>
          </div>
        </td>
        <td class="actions">
          <% if can? :update, shipment %>
            <%= link_to '', '#', :class => 'save-method icon_link icon-ok no-text with-tip',
              :data => {'shipment-number' => shipment.number, :action => 'save'}, title: Spree.t('actions.save') %>
            <%= link_to '', '#', :class => 'cancel-method icon_link icon-cancel no-text with-tip',
              :data => {:action => 'cancel'}, :title => Spree.t('actions.cancel') %>
          <% end %>
        </td>
      </tr>

      <tr class="show-method total">
        <% if shipment.shipping_method %>
        <td colspan="4">
          <strong><%= shipment.shipping_method.name %></strong>
        </td>
        <td class="total" align="center">
          <span><%= shipment.display_cost %></span>
        </td>
        <% else %>
        <td colspan='5'><%= Spree.t(:no_shipping_method_selected) %></td>
        <% end %>

        <td class="actions">
          <% if can? :update, shipment %>
          <%= link_to '', '#', :class => 'edit-method icon_link icon-edit no-text with-tip', :data => {:action => 'edit'}, :title => Spree.t('edit') %>
          <% end %>
        </td>
      </tr>
    <% end %>



    <% order.parcels.each do |parcel| %>
      <tr class="show-tracking total">
        <td colspan="6">
          <strong>Metapack consignment code: </strong><%= order.metapack_consignment_code %>
          <br>
          <% if parcel.metapack_tracking_url.present? %>
            <strong><%= Spree.t(:tracking_url) %>:</strong>
            <a href="<%= parcel.metapack_tracking_url %>"><%= parcel.metapack_tracking_url %></a>
          <% else %>
            <%= Spree.t(:no_tracking_present) %>
          <% end %>
        </td>

        <td class="actions">
        </td>
      </tr>
    <% end %>


    <% if order.special_instructions.present? %>
      <tr class='special_instructions'>
        <td colspan="6">
          <strong><%= Spree.t(:special_instructions) %>:&nbsp;</strong><%= order.special_instructions %>
        </td>
      </tr>
    <% end %>

  </tbody>
</table>
